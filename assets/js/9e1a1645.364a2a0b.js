"use strict";(globalThis.webpackChunkgo_feature_flag_website=globalThis.webpackChunkgo_feature_flag_website||[]).push([[56195],{4114:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>h,contentTitle:()=>d,default:()=>g,frontMatter:()=>c,metadata:()=>n,toc:()=>u});const n=JSON.parse('{"id":"relay-proxy/observability","title":"\ud83d\udc40 Observability","description":"Logging, Monitoring and Tracing of the relay proxy.","source":"@site/versioned_docs/version-v1.50.0/relay-proxy/observability.mdx","sourceDirName":"relay-proxy","slug":"/relay-proxy/observability","permalink":"/docs/v1.50.0/relay-proxy/observability","draft":false,"unlisted":false,"editUrl":"https://github.com/thomaspoignant/go-feature-flag/tree/main/website/versioned_docs/version-v1.50.0/relay-proxy/observability.mdx","tags":[],"version":"v1.50.0","sidebarPosition":80,"frontMatter":{"sidebar_position":80,"description":"Logging, Monitoring and Tracing of the relay proxy."},"sidebar":"tutorialSidebar","previous":{"title":"\ud83c\udf10 API endpoints","permalink":"/docs/v1.50.0/relay-proxy/relay_proxy_endpoints"},"next":{"title":"\ud83d\udcc8 Profiling","permalink":"/docs/v1.50.0/relay-proxy/profiling"}}');var o=r(74848),i=r(28453),s=r(11470),a=r(19365),l=r(11099);const c={sidebar_position:80,description:"Logging, Monitoring and Tracing of the relay proxy."},d="\ud83d\udc40 Observability",h={},u=[{value:"Overview",id:"overview",level:2},{value:"Logging",id:"logging",level:2},{value:"Tracing",id:"tracing",level:2},{value:"Monitoring",id:"monitoring",level:2},{value:"<code>/health</code>",id:"health",level:3},{value:"<code>/info</code>",id:"info",level:3},{value:"<code>/metrics</code>",id:"metrics",level:3},{value:"Use specific port for the monitoring",id:"use-specific-port-for-the-monitoring",level:2}];function p(e){const t={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"-observability",children:"\ud83d\udc40 Observability"})}),"\n",(0,o.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(t.p,{children:"Observability is crucial to know how your applications are working. And this is probably something you want to have for\nyour feature flag solution as well.\nThis is why GO Feature Flag relay-proxy offers out of the box some ways of monitor what is happening."}),"\n",(0,o.jsx)(t.h2,{id:"logging",children:"Logging"}),"\n",(0,o.jsxs)(t.p,{children:["GO Feature Flag relay proxy is using ",(0,o.jsx)(t.a,{href:"https://pkg.go.dev/go.uber.org/zap",children:"Zap"})," as the logging library."]}),"\n",(0,o.jsxs)(t.p,{children:["By default, the relay proxy is logging to the standard output with a JSON format in level ",(0,o.jsx)(t.code,{children:"INFO"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["You can change the log level by setting the ",(0,o.jsx)(t.code,{children:"logLevel"})," in your configuration file and you can choose the log format by setting the ",(0,o.jsx)(t.code,{children:"logFormat"})," options."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",metastring:'title="goff-proxy.yaml"',children:"#...\nlogLevel: ERROR\nlogFormat: json\n#...\n"})}),"\n",(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{children:"Field name"}),(0,o.jsx)(t.th,{style:{textAlign:"center"},children:"Mandatory"}),(0,o.jsx)(t.th,{children:"Type"}),(0,o.jsx)(t.th,{children:"Default"}),(0,o.jsx)(t.th,{children:"Description"})]})}),(0,o.jsxs)(t.tbody,{children:[(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"logLevel"}),(0,o.jsx)(t.td,{style:{textAlign:"center"},children:(0,o.jsx)(l.f,{})}),(0,o.jsx)(t.td,{children:"string"}),(0,o.jsx)(t.td,{children:(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"INFO"})})}),(0,o.jsxs)(t.td,{children:["The log level to use for the relay proxy.",(0,o.jsx)("br",{})," Available values are ",(0,o.jsx)(t.code,{children:"ERROR"}),", ",(0,o.jsx)(t.code,{children:"WARN"}),", ",(0,o.jsx)(t.code,{children:"INFO"}),", ",(0,o.jsx)(t.code,{children:"DEBUG"}),"."]})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"logFormat"}),(0,o.jsx)(t.td,{style:{textAlign:"center"},children:(0,o.jsx)(l.f,{})}),(0,o.jsx)(t.td,{children:"string"}),(0,o.jsx)(t.td,{children:(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"json"})})}),(0,o.jsxs)(t.td,{children:[(0,o.jsxs)("p",{children:["The format to use for structured logs from the relay proxy.",(0,o.jsx)("br",{}),"Valid values are ",(0,o.jsx)(t.code,{children:"json"})," and ",(0,o.jsx)(t.code,{children:"logfmt"}),"."]}),(0,o.jsx)("p",{children:(0,o.jsxs)("ul",{children:[(0,o.jsxs)("li",{children:[(0,o.jsx)(t.strong,{children:"json"}),": Will output the logs in ",(0,o.jsx)(t.code,{children:"JSON"})," format (default)."]}),(0,o.jsxs)("li",{children:[(0,o.jsx)(t.strong,{children:"logfmt"}),": Will output the log as text in the console."]})]})})]})]})]})]}),"\n",(0,o.jsx)(t.h2,{id:"tracing",children:"Tracing"}),"\n",(0,o.jsx)(t.p,{children:"The relay proxy will attempt to send traces to an OpenTelemetry collector or\ncompatible agent if an OpenTelemetry exporter endpoint is configured."}),"\n",(0,o.jsxs)(t.p,{children:["To set the endpoint, set the ",(0,o.jsx)(t.code,{children:"OTEL_EXPORTER_OTLP_ENDPOINT"})," environment variable\nor set ",(0,o.jsx)(t.code,{children:"otel.exporter.otlp.endpoint"})," in the configuration file."]}),"\n",(0,o.jsxs)(s.A,{groupId:"code",children:[(0,o.jsx)(a.A,{value:"env",label:"Environment variable",children:(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:"export OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317\n"})})}),(0,o.jsx)(a.A,{value:"yaml",label:"Configuration file",children:(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",metastring:'title="goff-proxy.yaml"',children:'# ...\notel:\n  exporter:\n    otlp:\n      endpoint: "http://localhost:4317"\n'})})})]}),"\n",(0,o.jsxs)(t.p,{children:["See ",(0,o.jsx)(t.a,{href:"https://opentelemetry.io/docs/specs/otel/configuration/sdk-environment-variables/",children:"the OpenTelemetry documentation"})," for more information."]}),"\n",(0,o.jsxs)(t.p,{children:["All your requests will be traced and sent to the collector with the service name ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"go-feature-flag"})}),"."]}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsxs)(t.p,{children:["If you want to try the OpenTelemetry integration locally, follow this ",(0,o.jsx)(t.a,{href:"https://github.com/thomaspoignant/go-feature-flag/tree/main/cmd/relayproxy/testdata/opentelemetry",children:"example"}),"\nto set up Jaeger and see your traces."]})}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.strong,{children:"relay proxy"})," offers some endpoints for you to be able to see how it behaves."]}),"\n",(0,o.jsx)(t.h3,{id:"health",children:(0,o.jsx)(t.code,{children:"/health"})}),"\n",(0,o.jsxs)(t.p,{children:["Making a ",(0,o.jsx)(t.strong,{children:"GET"})," request to the URL path ",(0,o.jsx)(t.code,{children:"/health"})," will tell you if the relay proxy is ready to\nserve traffic."]}),"\n",(0,o.jsx)(t.p,{children:"This is useful especially for loadbalancer to know that they can send traffic to the service."}),"\n",(0,o.jsx)(t.h3,{id:"info",children:(0,o.jsx)(t.code,{children:"/info"})}),"\n",(0,o.jsxs)(t.p,{children:["Making a ",(0,o.jsx)(t.strong,{children:"GET"})," request to the URL path ",(0,o.jsx)(t.code,{children:"/info"})," will give you information about the actual state\nof the relay proxy."]}),"\n",(0,o.jsx)(t.h3,{id:"metrics",children:(0,o.jsx)(t.code,{children:"/metrics"})}),"\n",(0,o.jsx)(t.p,{children:"This endpoint is providing metrics about the relay proxy in the prometheus format."}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsxs)(t.p,{children:["The relay proxy supports ",(0,o.jsx)(t.a,{href:"https://prometheus.io/docs/specs/native_histograms/",children:"Prometheus native histograms"})," for improved latency distribution precision. When scraping with Prometheus (especially using protobuf format), histogram metrics will include both classic bucket data and native histogram data for higher-fidelity percentile calculations. Classic histogram buckets are preserved for backward compatibility."]})}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"use-specific-port-for-the-monitoring",children:"Use specific port for the monitoring"}),"\n",(0,o.jsxs)(t.p,{children:["You can configure a different port for the monitoring endpoints.",(0,o.jsx)(t.br,{}),"\n","This is useful if you want to expose the monitoring endpoints on a different port than the main service."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",metastring:'title="goff-proxy.yaml"',children:"# ...\nmonitoringPort: 1032 # only the monitoring endpoints will be exposed on this port\n# ...\n"})}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"By default the monitoring endpoints are exposed on the same port as the main service."})})]})}function g(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(p,{...e})}):p(e)}},11099:(e,t,r)=>{r.d(t,{f:()=>o,q:()=>i});r(96540);var n=r(74848);const o=()=>(0,n.jsx)("i",{className:"fa-solid fa-xmark text-red-500"}),i=()=>(0,n.jsx)("i",{className:"fa-solid fa-check text-green-500"})},11470:(e,t,r)=>{r.d(t,{A:()=>T});var n=r(96540),o=r(34164),i=r(17559),s=r(23104),a=r(56347),l=r(205),c=r(57485),d=r(31682),h=r(70679);function u(e){return n.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function p(e){const{values:t,children:r}=e;return(0,n.useMemo)(()=>{const e=t??function(e){return u(e).map(({props:{value:e,label:t,attributes:r,default:n}})=>({value:e,label:t,attributes:r,default:n}))}(r);return function(e){const t=(0,d.XI)(e,(e,t)=>e.value===t.value);if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[t,r])}function g({value:e,tabValues:t}){return t.some(t=>t.value===e)}function f({queryString:e=!1,groupId:t}){const r=(0,a.W6)(),o=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,c.aZ)(o),(0,n.useCallback)(e=>{if(!o)return;const t=new URLSearchParams(r.location.search);t.set(o,e),r.replace({...r.location,search:t.toString()})},[o,r])]}function x(e){const{defaultValue:t,queryString:r=!1,groupId:o}=e,i=p(e),[s,a]=(0,n.useState)(()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!g({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const r=t.find(e=>e.default)??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:i})),[c,d]=f({queryString:r,groupId:o}),[u,x]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[r,o]=(0,h.Dv)(t);return[r,(0,n.useCallback)(e=>{t&&o.set(e)},[t,o])]}({groupId:o}),m=(()=>{const e=c??u;return g({value:e,tabValues:i})?e:null})();(0,l.A)(()=>{m&&a(m)},[m]);return{selectedValue:s,selectValue:(0,n.useCallback)(e=>{if(!g({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);a(e),d(e),x(e)},[d,x,i]),tabValues:i}}var m=r(92303);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=r(74848);function j({className:e,block:t,selectedValue:r,selectValue:n,tabValues:i}){const a=[],{blockElementScrollPositionUntilNextRender:l}=(0,s.a_)(),c=e=>{const t=e.currentTarget,o=a.indexOf(t),s=i[o].value;s!==r&&(l(t),n(s))},d=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const r=a.indexOf(e.currentTarget)+1;t=a[r]??a[0];break}case"ArrowLeft":{const r=a.indexOf(e.currentTarget)-1;t=a[r]??a[a.length-1];break}}t?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":t},e),children:i.map(({value:e,label:t,attributes:n})=>(0,b.jsx)("li",{role:"tab",tabIndex:r===e?0:-1,"aria-selected":r===e,ref:e=>{a.push(e)},onKeyDown:d,onClick:c,...n,className:(0,o.A)("tabs__item",y.tabItem,n?.className,{"tabs__item--active":r===e}),children:t??e},e))})}function v({lazy:e,children:t,selectedValue:r}){const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=i.find(e=>e.props.value===r);return e?(0,n.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:i.map((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==r}))})}function w(e){const t=x(e);return(0,b.jsxs)("div",{className:(0,o.A)(i.G.tabs.container,"tabs-container",y.tabList),children:[(0,b.jsx)(j,{...t,...e}),(0,b.jsx)(v,{...t,...e})]})}function T(e){const t=(0,m.A)();return(0,b.jsx)(w,{...e,children:u(e.children)},String(t))}},19365:(e,t,r)=>{r.d(t,{A:()=>s});r(96540);var n=r(34164);const o={tabItem:"tabItem_Ymn6"};var i=r(74848);function s({children:e,hidden:t,className:r}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,n.A)(o.tabItem,r),hidden:t,children:e})}},28453:(e,t,r)=>{r.d(t,{R:()=>s,x:()=>a});var n=r(96540);const o={},i=n.createContext(o);function s(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);