"use strict";(globalThis.webpackChunkgo_feature_flag_website=globalThis.webpackChunkgo_feature_flag_website||[]).push([[35067],{28453:(e,n,a)=>{a.d(n,{R:()=>i,x:()=>o});var t=a(96540);const s={},r=t.createContext(s);function i(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(r.Provider,{value:n},e.children)}},58749:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"configure_flag/rollout-strategies/percentage","title":"\ud83d\udcaf Percentage rollout","description":"A percentage rollout refers to a gradual release of a new feature to a subset of users.","source":"@site/versioned_docs/version-v1.50.0/configure_flag/rollout-strategies/percentage.md","sourceDirName":"configure_flag/rollout-strategies","slug":"/configure_flag/rollout-strategies/percentage","permalink":"/docs/v1.50.0/configure_flag/rollout-strategies/percentage","draft":false,"unlisted":false,"editUrl":"https://github.com/thomaspoignant/go-feature-flag/tree/main/website/versioned_docs/version-v1.50.0/configure_flag/rollout-strategies/percentage.md","tags":[],"version":"v1.50.0","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"description":"A percentage rollout refers to a gradual release of a new feature to a subset of users."},"sidebar":"tutorialSidebar","previous":{"title":"\ud83d\ude80 Rollouts","permalink":"/docs/v1.50.0/configure_flag/rollout-strategies/"},"next":{"title":"\ud83d\udcc8 Progressive rollout","permalink":"/docs/v1.50.0/configure_flag/rollout-strategies/progressive"}}');var s=a(74848),r=a(28453);const i={sidebar_position:10,description:"A percentage rollout refers to a gradual release of a new feature to a subset of users."},o="\ud83d\udcaf Percentage rollout",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Define a percentage rollout",id:"define-a-percentage-rollout",level:2},{value:"How percentage rollout works?",id:"how-percentage-rollout-works",level:2},{value:"Hash computation",id:"hash-computation",level:3},{value:"Bucket assignment",id:"bucket-assignment",level:3},{value:"Impact of changing percentages",id:"impact-of-changing-percentages",level:3},{value:"Examples",id:"examples",level:2},{value:"Define in the default rule",id:"define-in-the-default-rule",level:3},{value:"Define in a targeting rule",id:"define-in-a-targeting-rule",level:3},{value:"\ud83d\udc25 Canary releases",id:"-canary-releases",level:2}];function h(e){const n={admonition:"admonition",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"-percentage-rollout",children:"\ud83d\udcaf Percentage rollout"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"A percentage rollout refers to a gradual release of a new feature to a subset of users.\nInstead of making the feature available to everyone at once, you want to have only a subset of your customers to see the new feature."}),"\n",(0,s.jsx)(n.h2,{id:"define-a-percentage-rollout",children:"Define a percentage rollout"}),"\n",(0,s.jsx)(n.p,{children:"In GO Feature Flag, you can define a percentage rollout by setting the percentage of users that will see the new feature.\nYou can define the percentage in the flag configuration, and it works for the default rule or any other targeting rule you define."}),"\n",(0,s.jsxs)(n.p,{children:["The expected format is a map where the ",(0,s.jsx)(n.strong,{children:"key is the variation name"})," and the ",(0,s.jsx)(n.strong,{children:"value is the percentage"})," of users that will see this variation."]}),"\n",(0,s.jsx)(n.p,{children:"You can have as many variations as you want in the percentages, and you can define the percentage of users that will see each variation."}),"\n",(0,s.jsxs)(n.admonition,{type:"note",children:[(0,s.jsx)(n.p,{children:"If the sum of your percentages is not equal to 100 this is not a problem, we are computing the affectation as fractional numbers."}),(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:[(0,s.jsx)(n.strong,{children:"example"}),": if you have 2 variations and you set ",(0,s.jsx)(n.code,{children:"variation1: 10"})," and ",(0,s.jsx)(n.code,{children:"variation2: 50"})," it will be equivalent to ",(0,s.jsx)(n.code,{children:"variation1: 10/60"})," and ",(0,s.jsx)(n.code,{children:"variation2: 50/60"}),"."]})})]}),"\n",(0,s.jsx)(n.h2,{id:"how-percentage-rollout-works",children:"How percentage rollout works?"}),"\n",(0,s.jsx)(n.p,{children:"GO Feature Flag uses a deterministic hashing algorithm to ensure consistent user assignment to variations. Here's how it works:"}),"\n",(0,s.jsx)(n.h3,{id:"hash-computation",children:"Hash computation"}),"\n",(0,s.jsxs)(n.p,{children:["For each evaluation, GO Feature Flag computes a hash based on the ",(0,s.jsx)(n.strong,{children:"targeting key"})," (also called bucketing key) and the ",(0,s.jsx)(n.strong,{children:"flag name"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"hash = hash(targetingKey + flagName) % maxPercentage\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This hash produces a value between ",(0,s.jsx)(n.code,{children:"0"})," and ",(0,s.jsx)(n.code,{children:"maxPercentage"})," (which is the sum of all percentages). The hash function ensures that the same user (with the same targeting key) will always get the same hash value for a given flag, providing consistent assignment."]}),"\n",(0,s.jsx)(n.h3,{id:"bucket-assignment",children:"Bucket assignment"}),"\n",(0,s.jsxs)(n.p,{children:["All variations that are part of the percentage rollout are sorted by ",(0,s.jsx)(n.strong,{children:"reverse alphabetical"}),". This ensures consistent bucket assignment across evaluations."]}),"\n",(0,s.jsx)(n.p,{children:"For example, if you have the following percentages:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"percentage:\n  - varC: 20\n  - varB: 30\n  - varA: 50\n"})}),"\n",(0,s.jsx)(n.p,{children:"After sorting by inverse alphabetical order, the buckets are assigned as follows:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"0 to 20"}),": assigned to ",(0,s.jsx)(n.code,{children:"varC"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"20 to 50"}),": assigned to ",(0,s.jsx)(n.code,{children:"varB"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"50 to 100"}),": assigned to ",(0,s.jsx)(n.code,{children:"varA"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The hash value determines which bucket the user falls into, and thus which variation they receive."}),"\n",(0,s.jsx)(n.p,{children:"Since it is pure hash based, GO Feature Flag will always assign the evaluation context to the same bucket even if your evaluation is done on a different server or if you restart your relay-proxy."}),"\n",(0,s.jsx)(n.h3,{id:"impact-of-changing-percentages",children:"Impact of changing percentages"}),"\n",(0,s.jsxs)(n.p,{children:["When you have two variations, adjusting the percentages simply increases or decreases the number of users assigned to each variation.",(0,s.jsx)(n.br,{}),"\n","This allows you to gradually roll out a feature in a predictable and straightforward way."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"2 variations percentage bucket",src:a(99510).A+"",width:"1268",height:"442"})}),"\n",(0,s.jsxs)(n.p,{children:["But if you have ",(0,s.jsx)(n.strong,{children:"more than 2 variations"}),", this can have an impact on how your bucketing works.",(0,s.jsx)(n.br,{}),"\n","When you change the percentage configuration, ",(0,s.jsx)(n.strong,{children:"all buckets are recalculated"}),", which means users may be reassigned to different variations. This happens because the bucket boundaries shift based on the new percentages."]}),"\n",(0,s.jsx)(n.p,{children:"For example, if you change the configuration to:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"percentage:\n  - varC: 30\n  - varB: 30\n  - varA: 40\n"})}),"\n",(0,s.jsx)(n.p,{children:"The new bucket assignments become:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"0 to 30"}),": assigned to ",(0,s.jsx)(n.code,{children:"varC"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"30 to 60"}),": assigned to ",(0,s.jsx)(n.code,{children:"varB"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"60 to 100"}),": assigned to ",(0,s.jsx)(n.code,{children:"varA"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"As you can see in the diagram below, changing percentages shifts the bucket boundaries, which can move users from one variation to another:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Percentage Rollout Bucket Shifting",src:a(78823).A+"",width:"1612",height:"492"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"The deterministic hashing ensures that the same user will always get the same variation for a given configuration. However, when you change percentages, the bucket boundaries change, which may cause some users to be reassigned to different variations."})}),"\n",(0,s.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,s.jsx)(n.h3,{id:"define-in-the-default-rule",children:"Define in the default rule"}),"\n",(0,s.jsxs)(n.p,{children:["In this example ",(0,s.jsx)(n.code,{children:"99%"})," of the users will see the ",(0,s.jsx)(n.code,{children:"disabled"})," variation and ",(0,s.jsx)(n.code,{children:"1%"})," will see the ",(0,s.jsx)(n.code,{children:"enabled"})," variation."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="flag-config.goff.yaml"',children:"percentage-flag-1:\n  variations:\n    disabled: false\n    enabled: true\n  defaultRule:\n  # highlight-start\n    percentage:\n      disabled: 99\n      enabled: 1\n  # highlight-end\n"})}),"\n",(0,s.jsx)(n.h3,{id:"define-in-a-targeting-rule",children:"Define in a targeting rule"}),"\n",(0,s.jsxs)(n.p,{children:["In this second example, ",(0,s.jsx)(n.code,{children:"50%"})," of the users that are ",(0,s.jsx)(n.code,{children:"admin"})," will see the ",(0,s.jsx)(n.code,{children:"disabled"})," variation and ",(0,s.jsx)(n.code,{children:"50%"})," will see the ",(0,s.jsx)(n.code,{children:"enabled"})," variation.\nNon admin users will see the ",(0,s.jsx)(n.code,{children:"disabled"})," variation."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="flag-config.goff.yaml"',children:"percentage-flag-1:\n  variations:\n    disabled: false\n    enabled: true\n  targeting:\n    - query: admin eq true\n      # highlight-start\n      percentage:\n        disabled: 50\n        enabled: 50\n      # highlight-end\n  defaultRule:\n    variation: disabled\n\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-canary-releases",children:"\ud83d\udc25 Canary releases"}),"\n",(0,s.jsxs)(n.p,{children:["Percentage rollout are also known as ",(0,s.jsx)(n.strong,{children:"canary releases"}),", where you release a new feature to a small subset of users before rolling it out to everyone."]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},78823:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/percentage-buckets-5a0b5dcdf4757f340df3743398dff981.png"},99510:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/percentage-2-buckets-4fc2e9442de3adfe2d86094c49595fcb.png"}}]);