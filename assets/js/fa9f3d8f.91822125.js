"use strict";(globalThis.webpackChunkgo_feature_flag_website=globalThis.webpackChunkgo_feature_flag_website||[]).push([[54446],{28453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>l});var r=a(96540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}},34729:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"concepts/flag-evaluation","title":"\ud83d\udea5 Flag Evaluation","description":"Flag evaluation dynamically determines a feature flag\'s state at runtime based on context and targeting rules.","source":"@site/versioned_docs/version-v1.50.0/concepts/flag-evaluation.md","sourceDirName":"concepts","slug":"/concepts/flag-evaluation","permalink":"/docs/v1.50.0/concepts/flag-evaluation","draft":false,"unlisted":false,"editUrl":"https://github.com/thomaspoignant/go-feature-flag/tree/main/website/versioned_docs/version-v1.50.0/concepts/flag-evaluation.md","tags":[],"version":"v1.50.0","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"description":"Flag evaluation dynamically determines a feature flag\'s state at runtime based on context and targeting rules."},"sidebar":"tutorialSidebar","previous":{"title":"\ud83d\udca1 Concepts"},"next":{"title":"\ud83d\udd0e Evaluation Context","permalink":"/docs/v1.50.0/concepts/evaluation-context"}}');var i=a(74848),t=a(28453);const o={sidebar_position:10,description:"Flag evaluation dynamically determines a feature flag's state at runtime based on context and targeting rules."},l="\ud83d\udea5 Flag Evaluation",s={},d=[{value:"Overview",id:"overview",level:2},{value:"What Happens During Evaluation?",id:"what-happens-during-evaluation",level:2},{value:"Supported type of flags",id:"supported-type-of-flags",level:2},{value:"Example",id:"example",level:2},{value:"Basic evaluation with GO Feature Flag",id:"basic-evaluation-with-go-feature-flag",level:2},{value:"Benefits of Dynamic Evaluation",id:"benefits-of-dynamic-evaluation",level:2},{value:"How Evaluation is performed inside your provider?",id:"how-evaluation-is-performed-inside-your-provider",level:2},{value:"Client Provider",id:"client-provider",level:3},{value:"Server Provider: In Process Evaluation",id:"server-provider-in-process-evaluation",level:3},{value:"Server Provider: Remote Evaluation",id:"server-provider-remote-evaluation",level:3}];function u(e){const n={a:"a",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components},{Details:a}=n;return a||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"-flag-evaluation",children:"\ud83d\udea5 Flag Evaluation"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["In a feature flag system, flag evaluation is the process of determining the current state ",(0,i.jsx)(n.em,{children:"(which variant to use)"})," of a feature flag for a given ",(0,i.jsx)(n.a,{href:"/docs/v1.50.0/concepts/evaluation-context",children:"evaluation context"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"This process happens at runtime, allowing you to dynamically control the behavior of your application without redeploying code."}),"\n",(0,i.jsx)(n.h2,{id:"what-happens-during-evaluation",children:"What Happens During Evaluation?"}),"\n",(0,i.jsx)(n.p,{children:"The evaluation process typically involves these steps:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Retrieving the Flag Configuration:"})," The system fetches the configuration for the specific flag being evaluated. This configuration includes information such as the flag's default value, targeting rules, and any other relevant settings."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Contextual Input:"})," The evaluation receives context about the current request or user. This context can include information like:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A targeting key"}),"\n",(0,i.jsx)(n.li,{children:"Device type"}),"\n",(0,i.jsx)(n.li,{children:"Location"}),"\n",(0,i.jsx)(n.li,{children:"Custom attributes"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Rule Evaluation:"})," The system evaluates the targeting rules defined for the flag against the provided context. These rules determine which users or requests should see the feature enabled (or a specific variant). Common targeting strategies include:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Percentage rollout:"})," Enable the feature for a percentage of users ",(0,i.jsx)(n.em,{children:"(e.g., 50%)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"User targeting:"})," Enable the feature for specific users."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Attribute-based targeting:"})," Enable the feature based on user attributes ",(0,i.jsx)(n.em,{children:'(e.g., users with a "premium" subscription)'}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Returning the Flag Value:"})," Based on the rule evaluation, the system returns the appropriate value for the flag (e.g., ",(0,i.jsx)(n.code,{children:"true"}),", ",(0,i.jsx)(n.code,{children:"false"}),", or a variant value like ",(0,i.jsx)(n.code,{children:'"variantA"'}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"supported-type-of-flags",children:"Supported type of flags"}),"\n",(0,i.jsx)(n.p,{children:"GO Feature Flag supports a variety of flag types, including:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Boolean"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"String"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Integer"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Double"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Object"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"For each flag type, the SDKs are providing specific APIs to be able to retrieve your flag in the right type inside your code."}),"\n",(0,i.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,i.jsxs)(n.p,{children:["Let's say you have a feature flag called ",(0,i.jsx)(n.code,{children:"new_checkout_flow"})," with the following configuration:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="flags.goff.yaml"',children:'new_checkout_flow:\n  variations:\n    enabled: true\n    disabled: false\n  targeting:\n    - query: user_segment eq "early_adopters"\n      variation: enabled\n  defaultRule:\n    percentage:\n      enabled: 20\n      disabled: 80\n'})}),"\n",(0,i.jsxs)(n.p,{children:["If a user belongs to the ",(0,i.jsx)(n.code,{children:"early_adopters"})," segment, the flag evaluation will return ",(0,i.jsx)(n.code,{children:"true"}),".",(0,i.jsx)(n.br,{}),"\n","If a user does not belong to that segment, there's a ",(0,i.jsx)(n.strong,{children:"20% chance"})," the flag will return ",(0,i.jsx)(n.code,{children:"true"})," due to the percentage rollout rule. Otherwise, the flag will return the ",(0,i.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"basic-evaluation-with-go-feature-flag",children:"Basic evaluation with GO Feature Flag"}),"\n",(0,i.jsxs)(n.p,{children:["After setting up your flag configuration, you can evaluate the flag in your application code.\nFor this example ",(0,i.jsx)(n.em,{children:"(in JS)"}),", we'll use the OpenFeature SDKs, with a GO Feature Flag provider:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'const evaluationContext = {\n  targetingKey: "<my-key>",\n   "user_segment": "early_adopters",\n};\nconst defaultValue = false;\n\n// get a boolean value\nconst boolValue = await client.getBooleanValue(\n  \'new_checkout_flow\',\n  defaultValue,\n  evaluationContext);\n'})}),"\n",(0,i.jsxs)(n.p,{children:["As you can see, the evaluation context API takes 3 parameters ",(0,i.jsx)(n.em,{children:"(this is true in most languages)"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The name of the flag to evaluate."}),"\n",(0,i.jsx)(n.li,{children:"A default value to return if the flag is not found or the evaluation fails. The evaluation API will always return a value, even if there is an error."}),"\n",(0,i.jsxs)(n.li,{children:["An evaluation context giving information about the current user or request ",(0,i.jsxs)(n.em,{children:["(",(0,i.jsx)(n.a,{href:"/docs/v1.50.0/concepts/evaluation-context",children:"more information about evaluation context"}),")"]}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["You can also see that we explicitely asking for a boolean value because ",(0,i.jsx)(n.code,{children:"new_checkout_flow"})," is a boolean flag."]}),"\n",(0,i.jsx)(n.h2,{id:"benefits-of-dynamic-evaluation",children:"Benefits of Dynamic Evaluation"}),"\n",(0,i.jsx)(n.p,{children:"Dynamic flag evaluation provides several advantages:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Instant control:"})," Change the state of features without deploying new code."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"A/B testing:"})," Run experiments and gather data on different feature variations."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Gradual rollouts:"})," Release features to a small group of users before wider deployment."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Kill switches:"})," Quickly disable problematic features in production."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"how-evaluation-is-performed-inside-your-provider",children:"How Evaluation is performed inside your provider?"}),"\n",(0,i.jsxs)(n.p,{children:["Feature flag evaluation in GO Feature Flag depends on which type of SDK and provider you are using in your application.",(0,i.jsx)(n.br,{}),"\n","There are two main categories ",(0,i.jsx)(n.strong,{children:"Client Providers"})," and ",(0,i.jsx)(n.strong,{children:"Server Providers"})," (see ",(0,i.jsx)(n.a,{href:"/docs/v1.50.0/concepts/sdk-paradigms",children:"SDK paradigms"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"The evaluation process is handled differently for each, bellow we will detail all the flows."}),"\n",(0,i.jsx)(n.h3,{id:"client-provider",children:"Client Provider"}),"\n",(0,i.jsx)(n.p,{children:"When using a client SDK (e.g., JavaScript/React, Android, Swift), since you have a single evaluation context, GO Feature Flag will evaluate all flags once and you will use the local cache of evaluation."}),"\n",(0,i.jsx)(a,{children:(0,i.jsx)(n.mermaid,{value:'sequenceDiagram\n    box "Inside your application"\n        participant app as Client<br/>Application\n        participant sdk as OpenFeature<br/>SDK\n        participant provider as GO Feature Flag<br/>provider\n    end\n    box GO Feature Flag\n        participant goff as GO Feature Flag<br />Relay Proxy\n    end\n\n    note over app: SDK initializaition\n    app ->> sdk: Initialize OpenFeature + set Evaluation Context\n    sdk ->> provider: Call provider init method\n    provider ->> goff: Evaluate all flags\n    goff ->> goff: Perform evaluation of all flags\n    goff --\x3e> provider: Evaluation responses\n    provider --\x3e> provider: Store evaluation responses in memory\n    note over provider, goff: Bulk evaluation will be performed periodically <br/> if configuration change happens\n    provider --\x3e> sdk: Provider Ready\n    sdk --\x3e> app:\n\n    note over app: 1st evaluation\n    app ->> sdk: Evaluate flag "darkMode"<br/>with evalution context\n    sdk ->> provider: \n    provider ->> provider: Get evaluation response for "darkMode"\n    provider --\x3e> sdk: Evaluation response\n    sdk --\x3e> app:\n\n    note over app: 2nd evaluation\n    app ->> sdk: Evaluate flag "newOnboarding"<br/>with evalution context\n    sdk ->> provider: \n    provider ->> provider: Get evaluation response for "newOnboarding"\n    provider --\x3e> sdk: Evaluation response\n    sdk --\x3e> app:'})}),"\n",(0,i.jsx)(n.h3,{id:"server-provider-in-process-evaluation",children:"Server Provider: In Process Evaluation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Your server-side provider is configured to call the Relay Proxy for flag evaluations."}),"\n",(0,i.jsx)(n.li,{children:"This can simplify config management and centralize evaluations, but adds network round-trips on every evaluation."}),"\n"]}),"\n",(0,i.jsx)(a,{children:(0,i.jsx)(n.mermaid,{value:'sequenceDiagram\n    box "Inside your application"\n        participant app as Server<br/>Application\n        participant sdk as OpenFeature<br/>SDK\n        participant provider as GO Feature Flag<br/>provider\n    end\n    box GO Feature Flag\n        participant goff as GO Feature Flag<br />Relay Proxy\n    end\n\n    note over app: SDK initializaition\n    app ->> sdk: Initialize OpenFeature\n    sdk ->> provider: Call provider init method\n    provider --\x3e> goff: Retrieve flag configuration\n    goff --\x3e> provider: Flag configuration\n    provider --\x3e> provider: Store configuration in memory\n    note over provider, goff: Configuration will be refreshed periodically<br/>if configuration change happens\n    provider --\x3e> sdk: Provider Ready\n    sdk --\x3e> app:\n\n    note over app: 1st evaluation\n    app ->> sdk: Evaluate flag "darkMode"<br/>with evalution context\n    sdk ->> provider: \n    provider ->> provider: Perform evaluation inside the provider\n    provider --\x3e> sdk: Evaluation response\n    sdk --\x3e> app:\n\n    note over app: 2nd evaluation\n    app ->> sdk: Evaluate flag "newOnboarding"<br/>with evalution context\n    sdk ->> provider: \n    provider ->> provider: Perform evaluation inside the provider\n    provider --\x3e> sdk: Evaluation response\n    sdk --\x3e> app: '})}),"\n",(0,i.jsx)(n.h3,{id:"server-provider-remote-evaluation",children:"Server Provider: Remote Evaluation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Your server-side provider is configured to call the Relay Proxy for flag evaluations."}),"\n",(0,i.jsx)(n.li,{children:"This can simplify config management and centralize evaluations, but adds network round-trips on every evaluation."}),"\n"]}),"\n",(0,i.jsx)(a,{children:(0,i.jsx)(n.mermaid,{value:'sequenceDiagram\n    box "Inside your application"\n        participant app as Server<br/>Application\n        participant sdk as OpenFeature<br/>SDK\n        participant provider as GO Feature Flag<br/>provider\n    end\n    box GO Feature Flag\n        participant goff as GO Feature Flag<br />Relay Proxy\n    end\n\n    note over app: SDK initializaition\n    app ->> sdk: Initialize OpenFeature\n    sdk ->> provider: Call provider init method\n    provider --\x3e> provider: Provider init\n    provider --\x3e> sdk: Provider Ready\n    sdk --\x3e> app:\n\n    note over app: 1st evaluation\n    app ->> sdk: Evaluate flag "darkMode"<br/>with evalution context\n    sdk ->> provider: \n    provider ->> goff: Call evaluation API for "darkMode"<br/>with evalution context\n    goff --\x3e> goff: Perform evaluation\n    goff --\x3e> provider: Evaluation response\n    provider --\x3e> sdk:\n    sdk --\x3e> app:\n\n    note over app: 2nd evaluation\n    app ->> sdk: Evaluate flag "newOnboarding"<br/>with evalution context\n    sdk ->> provider: \n    provider ->> goff: Call evaluation API for "newOnboarding"<br/>with evalution context\n    goff --\x3e> goff: Perform evaluation\n    goff --\x3e> provider: Evaluation response\n    provider --\x3e> sdk: \n    sdk --\x3e> app: '})})]})}function c(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}}}]);