"use strict";(globalThis.webpackChunkgo_feature_flag_website=globalThis.webpackChunkgo_feature_flag_website||[]).push([[62404],{28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var i=n(96540);const s={},a=i.createContext(s);function o(e){const t=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:t},e.children)}},93984:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>u});const i=JSON.parse('{"id":"configure_flag/custom-bucketing","title":"\ud83e\udea3 Custom Bucketing","description":"How to bucket users based on a custom identifier","source":"@site/versioned_docs/version-v1.47.1/configure_flag/custom-bucketing.md","sourceDirName":"configure_flag","slug":"/configure_flag/custom-bucketing","permalink":"/docs/v1.47.1/configure_flag/custom-bucketing","draft":false,"unlisted":false,"editUrl":"https://github.com/thomaspoignant/go-feature-flag/tree/main/website/versioned_docs/version-v1.47.1/configure_flag/custom-bucketing.md","tags":[],"version":"v1.47.1","sidebarPosition":30,"frontMatter":{"sidebar_position":30,"description":"How to bucket users based on a custom identifier"},"sidebar":"tutorialSidebar","previous":{"title":"\ud83c\udfaf Target with Flags","permalink":"/docs/v1.47.1/configure_flag/target-with-flags"},"next":{"title":"\ud83d\ude80 Rollouts","permalink":"/docs/v1.47.1/configure_flag/rollout-strategies/"}}');var s=n(74848),a=n(28453);const o={sidebar_position:30,description:"How to bucket users based on a custom identifier"},r="\ud83e\udea3 Custom Bucketing",l={},u=[{value:"Overview",id:"overview",level:2},{value:"How it works",id:"how-it-works",level:2},{value:"Example: Split users based on their team ID",id:"example-split-users-based-on-their-team-id",level:2}];function c(e){const t={admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"-custom-bucketing",children:"\ud83e\udea3 Custom Bucketing"})}),"\n",(0,s.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(t.p,{children:["When it comes to splitting the affectation of a flag, the ",(0,s.jsx)(t.code,{children:"targetingKey"})," is usually given a user ID. This key ensures that a user will always be in the same group for each flag."]}),"\n",(0,s.jsxs)(t.p,{children:["But sometimes we want to be sure that a group of users will always be in the same group for each flag.\nThe ",(0,s.jsx)(t.code,{children:"bucketingKey"})," field in the flag configuration allows you to define a different identifier to be used instead of the ",(0,s.jsx)(t.code,{children:"targetingKey"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"This enables you to split users based on a custom identifier, such as a team ID, a company ID, or any other attribute that is common to multiple users."}),"\n",(0,s.jsx)(t.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,s.jsxs)(t.p,{children:["When evaluating flags, the ",(0,s.jsx)(t.code,{children:"targetingKey"})," is used to build the hash that will allow GO Feature Flag to affect the user to a variation, if a ",(0,s.jsx)(t.code,{children:"bucketingKey"})," is defined, it will be used instead of the ",(0,s.jsx)(t.code,{children:"targetingKey"}),"."]}),"\n",(0,s.jsx)(t.mermaid,{value:"stateDiagram-v2\n    direction LR\n    Evaluation&nbsp;Context --\x3e Build&nbsp;Hash<br/><sub>(bucketing&nbsp;key&nbsp;+&nbsp;flag&nbsp;name)</sub>\n    Build&nbsp;Hash<br/><sub>(bucketing&nbsp;key&nbsp;+&nbsp;flag&nbsp;name)</sub> --\x3e Affect&nbsp;bucket\n    Affect&nbsp;bucket --\x3e variation&nbsp;1: 10%\n    Affect&nbsp;bucket --\x3e variation&nbsp;2: 40%\n    Affect&nbsp;bucket --\x3e variation&nbsp;3: 50%"}),"\n",(0,s.jsx)(t.p,{children:"Since we are using an attribute that is common to multiple users at the same time, we can ensure that all users with the same attribute will always be in the same group."}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["If a value in the corresponding ",(0,s.jsx)(t.code,{children:"bucketingKey"})," is not found in the ",(0,s.jsx)(t.strong,{children:"evaluation context"}),", the flag rules will not be evaluated, and the SDK will return the default value."]}),"\n",(0,s.jsxs)(t.li,{children:["Since the ",(0,s.jsx)(t.code,{children:"bucketingKey"})," is not unique to a user, you can end up with a not uniform distribution of users in the variations depending on the repartition of the ",(0,s.jsx)(t.code,{children:"bucketingKey"})," values."]}),"\n"]})}),"\n",(0,s.jsx)(t.h2,{id:"example-split-users-based-on-their-team-id",children:"Example: Split users based on their team ID"}),"\n",(0,s.jsx)(t.p,{children:"Let's say you want to rollout a new feature and be sure that all the members of the same team will receive the same variation."}),"\n",(0,s.jsxs)(t.p,{children:["To achieve this, you can define the ",(0,s.jsx)(t.code,{children:"bucketingKey"})," to be the ",(0,s.jsx)(t.code,{children:"teamId"})," in the flag configuration."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'title="flag-config.goff.yaml"',children:'scream-level-feature:\n  # highlight-next-line\n  bucketingKey: "teamId"\n  variations:\n    low: "whisper"\n    medium: "talk"\n    high: "scream"\n  defaultRule:\n    percentage:\n      medium: 50\n      high: 50\n'})}),"\n",(0,s.jsxs)(t.p,{children:["With this flag configuration, the ",(0,s.jsx)(t.code,{children:"teamId"})," value will be used for hashing instead of ",(0,s.jsx)(t.code,{children:"targetingKey"}),". The value must be provided to the evaluation context:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-go",metastring:'title="example.go"',children:'evalCtx := openfeature.NewEvaluationContext(\n    "user-123",\n    map[string]interface{}{\n        "teamId", "f74b72",\n    },\n)\nboolValue, _ := client.BooleanValue("first-flag", false, evalCtx)\n'})}),"\n",(0,s.jsxs)(t.p,{children:["As a result, users who are members of the same team will receive the same flag variation, consistently.",(0,s.jsx)(t.br,{}),"\n","A different ",(0,s.jsx)(t.code,{children:"bucketingKey"})," can be used per experiment, though normally you'll only have a handful of possible values."]})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);